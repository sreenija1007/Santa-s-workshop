<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Santa's Adaptive Workshop</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/animations.css">
</head>
<body class="theme-santa"> 
    <header class="game-header">
        <div class="brand">ğŸ… Santa's Workshop</div>
        <div class="stats-bar" style="display: flex; align-items: center; gap: 15px;">
            <span class="magic-dust">âœ¨ Magic Dust: <span id="dust-count">0</span></span>
            
            <select id="theme-selector" onchange="changeTheme(this.value)" style="padding: 5px; border-radius: 15px; border: none; font-size: 0.9rem; cursor: pointer;">
                <option value="santa">ğŸ… Classic Santa</option>
                <option value="frozen">â„ï¸ Frozen Realm</option>
                <option value="midnight">ğŸŒ™ Midnight Ride</option>
            </select>

            <span class="user-profile">
                ğŸ‘¤ <span id="username-display">Guest</span> 
                <button id="logout-btn" class="logout-link">Sign Out</button>
            </span>
        </div>
    </header>

    <div class="main-container">
        
        <aside class="side-panel">
            <div class="panel-box audio-box">
                <h3>ğŸ¶ North Pole Radio</h3>
                
                <div class="visualizer-container">
                    <div class="bar"></div>
                    <div class="bar"></div>
                    <div class="bar"></div>
                    <div class="bar"></div>
                    <div class="bar"></div>
                </div>

                <div class="track-info">
                    <marquee scrollamount="3" id="track-name">ğŸµ Jingle Bells (8-Bit Remix)</marquee>
                </div>

                <div class="audio-controls">
                    <button class="btn-audio" onclick="audioManager.prevTrack()">â®ï¸</button>
                    <button class="btn-audio" onclick="audioManager.togglePlay()" id="play-btn">â–¶ï¸</button>
                    <button class="btn-audio" onclick="audioManager.nextTrack()">â­ï¸</button>
                </div>

                <div class="volume-control">
                    <span>ğŸ”ˆ</span>
                    <input type="range" id="volume-slider" min="0" max="1" step="0.1" value="0.5">
                    <span>ğŸ”Š</span>
                </div>
            </div>
            <div class="panel-box story-box">
                <div style="display:flex; justify-content:space-between; align-items:center;">
                    <h3 style="margin:0;">ğŸ“– Christmas Chronicle</h3>
                    <button onclick="resetStory()" style="font-size:0.7rem; background:none; border:1px solid #ccc; cursor:pointer; padding:2px 5px; border-radius:4px;">Reset</button>
                </div>
                
                <p id="story-text" style="min-height: 60px;">The workshop is quiet. Too quiet. Santa needs your help to get the engine running...</p>
                
                <div id="story-choices" class="hidden"></div>
            </div>

            <div class="panel-box analytics-box">
                <h3>ğŸ“Š Performance Prediction</h3>
                <p>Est. Time: <span id="predicted-time">--:--</span></p>
                <p>Win Chance: <span id="win-chance">--%</span></p>
            </div>

            <div class="panel-box history-box">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                    <h3 style="margin:0;">ğŸ“œ Activity</h3>
                    <div class="tab-buttons">
                        <button onclick="switchTab('history')" id="tab-me" style="cursor:pointer; background:none; border:none; font-weight:bold; color:var(--primary-color);">Me</button>
                        <span>|</span>
                        <button onclick="switchTab('leaderboard')" id="tab-top" style="cursor:pointer; background:none; border:none; color:#666;">Global</button>
                        <span>|</span>
                        <button onclick="switchTab('friends')" id="tab-friends" style="cursor:pointer; background:none; border:none; color:#666;">Friends</button>
                    </div>
                </div>
                
                <ul id="history-list" style="list-style: none; padding: 0; font-size: 0.85rem;">
                    <li style="color: #666; font-style: italic;">Loading...</li>
                </ul>

                <div id="leaderboard-container" style="display:none;">
                    
                    <div id="friend-add-ui" style="display:none; flex-direction:column; gap:5px; margin-bottom: 10px;">
                        <div style="display:flex; gap:5px;">
                            <input type="text" id="friend-input" placeholder="Enter username..." style="flex:1; padding: 4px; font-size: 0.8rem;">
                            <button onclick="sendFriendRequest()" class="btn-primary" style="padding: 2px 8px; font-size: 0.8rem;">Request</button>
                        </div>
                        <div id="requests-list"></div>
                    </div>

                    <ul id="leaderboard-list" style="list-style: none; padding: 0; font-size: 0.85rem;"></ul>
                </div>
            </div>
        </aside>

        <main class="game-area">
            
            <div class="controls">
                <select id="difficulty-select">
                    <option value="3">3x3 (Easy)</option>
                    <option value="4" selected>4x4 (Classic)</option>
                    <option value="6">6x6 (Hard)</option>
                    <option value="8">8x8 (Expert)</option>
                    <option value="10">10x10 (Santa)</option>
                </select>
                <button id="start-btn" class="btn-primary">Start Building</button>
            </div>

            <div class="timer-display" style="font-size: 1.5rem; margin: 10px 0; font-weight: bold;">
                â±ï¸ <span id="timer">00:00</span>
            </div>
            <div id="puzzle-grid" class="grid-container"></div>
            
            <button onclick="document.getElementById('puzzle-grid').classList.toggle('hide-numbers')" 
                    style="margin-top:10px; background:none; border:1px solid #ccc; padding:5px 10px; cursor:pointer; font-size:0.8rem; border-radius:15px;">
                ğŸ‘ï¸ Toggle Numbers
            </button>
        </main>
        
        <aside class="side-panel">
            <div class="panel-box shop-box">
                <h3>âš¡ Holiday Magic</h3>
                <button class="power-up-btn" onclick="gameInstance.activateFreeze()">
                    â„ï¸ Freeze Time (50 Dust)
                </button>
                
                <button class="power-up-btn" onclick="gameInstance.activatePreview()">
                    ğŸŒŸ Golden Peek (75 Dust)
                </button>
            </div>

            <div class="panel-box social-box">
                <h3>ğŸ Gifts Unlocked</h3>
                <div id="gift-gallery">
                    <div class="gift locked">â“</div>
                    <div class="gift locked">â“</div>
                    <div class="gift locked">â“</div>
                </div>
            </div>
        </aside>

    </div>
    
    <script src="js/story.js"></script>
    <script src="js/main.js"></script>
    <script src="js/puzzle.js"></script>
</body>
</html>